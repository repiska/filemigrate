# File Migrator Utility

Утилита для миграции файлов из плоской структуры в структуру по датам (YYYYMMDD).

## Описание

Данная утилита предназначена для переноса большого количества файлов (1M+) из плоской файловой структуры в организованную структуру по датам. Файлы перемещаются в подкаталоги, названные по дате их помещения в базу данных (формат YYYYMMDD).

## Возможности

- ✅ Миграция файлов в структуру по датам
- ✅ Обновление статуса в базе данных
- ✅ Обратная совместимость чтения файлов
- ✅ Батчевая обработка для больших объемов
- ✅ Подробное логирование процесса
- ✅ Поддержка SQL Server и MySQL
- ✅ CLI интерфейс для удобства использования

## Установка

### 1. Клонирование и настройка окружения

```bash
# Создание виртуального окружения
python -m venv venv

# Активация окружения (Windows)
.\venv\Scripts\Activate.ps1

# Активация окружения (Linux/Mac)
source venv/bin/activate

# Обновление pip
python -m pip install --upgrade pip

# Установка зависимостей
pip install -r requirements.txt
```

### 2. Настройка конфигурации

1. Скопируйте `.env.example` в `.env` и заполните ваши данные:
   ```bash
   cp .env.example .env
   ```

2. Отредактируйте `config/settings.ini` под вашу конфигурацию БД и путей.

## Использование

### Основные команды

```bash
# Миграция всех файлов
python src/main.py migrate

# Миграция с указанием размера батча
python src/main.py migrate --batch-size 500

# Чтение файла по IDFL
python src/main.py read <IDFL>

# Запись нового файла
python src/main.py write <filename>
```

### Параметры командной строки

```bash
# Общие параметры
--config path/to/config.ini    # Путь к конфигурационному файлу
--verbose                      # Подробный вывод
--dry-run                      # Тестовый режим без изменений

# Для команды migrate
--batch-size N                 # Размер батча (по умолчанию 1000)
--max-files N                  # Максимальное количество файлов для обработки
```

## Структура проекта

```
utilita/
├── config/
│   └── settings.ini          # Конфигурация приложения
├── logs/                     # Файлы логов
├── src/                      # Исходный код
│   ├── __init__.py
│   ├── main.py              # Точка входа CLI
│   ├── config_loader.py     # Загрузка конфигурации
│   ├── logger.py            # Настройка логирования
│   ├── db.py                # Работа с базой данных
│   ├── file_ops.py          # Операции с файлами
│   └── migrator.py          # Бизнес-логика миграции
├── tests/                   # Тесты
│   ├── __init__.py
│   ├── test_db.py
│   ├── test_file_ops.py
│   └── test_migrator.py
├── requirements.txt         # Зависимости Python
├── .env.example            # Пример переменных окружения
├── .gitignore              # Игнорируемые файлы Git
└── README.md               # Документация
```

## Тестирование

```bash
# Запуск всех тестов
pytest tests/

# Запуск с покрытием кода
pytest tests/ --cov=src

# Запуск конкретного теста
pytest tests/test_db.py -v
```

## Разработка

### Форматирование кода

```bash
# Форматирование с помощью black
black src/ tests/

# Проверка стиля кода
flake8 src/ tests/

# Проверка типов
mypy src/
```

## Требования

- Python 3.11+
- SQL Server или MySQL
- Достаточно места на диске для файлов
- Права на запись в целевые каталоги

## Лицензия

MIT License

## Поддержка

При возникновении проблем создайте issue в репозитории проекта.
